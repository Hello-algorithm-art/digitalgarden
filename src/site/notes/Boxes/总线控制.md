---
{"dg-publish":true,"permalink":"/Boxes/总线控制/","dgPassFrontmatter":true,"created":"2025-05-08T15:31:53.247+08:00","updated":"2025-05-18T10:22:09.203+08:00"}
---

## 总线判优
解决总线使用权问题，根据设备优先级
### 1.链式查询
![file-20250508161204600.png|400](/img/user/images/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6/file-20250508161204600.png)
优点：三根控制线，易扩展
缺点：对电路故障敏感，优先级低的设备难以获得使用权
### 2.计数器定时查询
控制线条数：多增加设备地址线（以二为底取对数向上取整）加上BS,BR
- 总线控制部件接收到BR的请求信号，在BS=0时，控制部件内计数器开始计数，通过设备地址线向各设备发出地址信号，匹配到相应设备，获得控制权

- 计数可以从零开始
- 计数可以从上次终点开始，此时设备优先级相等
![file-20250508161831814.png|400](/img/user/images/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6/file-20250508161831814.png)
### 3.独立请求
- 响应呢速度快，优先次序灵活
- 控制线数量多，控制负责
![file-20250508162036745.png|400](/img/user/images/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6/file-20250508162036745.png)
## 总线通信控制
解决主设备从设备协调配合问题
### 总线周期
申请分配，主模块申请，总线仲裁决定
寻址，主模块向从模块提供地址和命令
传数，主从模块交换数据
结束，主模块撤销信息
### 通信方式
#### 同步，统一时标控制数据传送
给定时间点完成对应操作
- 同步数据输入
![file-20250517211723555.png](/img/user/images/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6/file-20250517211723555.png)
- T1上升沿，主设备给出地址信号
- T2上升沿，主设备发出读命令
- T3上升沿，从设备将数据线信息传送到寄存器中
- T4上升沿，撤销数据信号和控制信号
优点：配合简单一致
缺点：主从模块强制同步，按最慢部件设计公共时钟
用于总线较短，各部件存取时间比较一致的场景
#### 异步，采用应答方式
要求主从模块之间添加两条应答线
1. 不互锁，从设备收到主设备请求信号后发送应答信号
2. 半互锁，从设备收到主设备请求信号后发送应答信号，主设备收到从设备应答信号后撤销请求信号
3. 全互锁，从设备收到主设备请求信号后发送应答信号，主设备收到从设备应答信号后撤销请求信号，从设备收到主设备请求撤销信号后撤销应答信号
![file-20250517215615260.png](/img/user/images/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6/file-20250517215615260.png)
约定字符传输格式为：1个起始位，5-8个数据位，1个奇偶校验位，1或1.5或2个终止位
- 比特率：数据位数
- 波特率：二进制位数

### 半同步(同步异步结合)
同步指同一时钟信号控制，异步指增加等待信号，允许不同速度模块协调工作，添加等待信号

- T1主模块发地址
- T2主模块发命令(若在T3时刻前从模块没有准备好数据，添加等待时间)
- Tw当等待信号为低电平，等待一个T
- T3从模块提供数据
- T4从模块撤销数据，主模块撤销命令

#### 以上三种通信的共同点
- 主模块发送地址，命令
- 从模块准备数据
- 从模块向主模块发数据
### 分离式通信，挖掘总线每个瞬间潜力
一个总线传输周期
- 子周期1，主模块占用总线，之后放弃
- 子周期2，从模块占用总线

- 各模块有权申请占用总线
- 同步方式通信
- 各模块准备数据，不占用总线
- 总线被占用时，一定在传输数据